<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>PlagiarismSearch Sample reports API</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">
</head>

<style>
	body {
		padding: 50px 90px 50px 90px;
	}

	.form-control {
		/*font-size: 14px;*/
		resize: none;
	}

	.titulo {
		color: inherit;
	}

	.titulo:hover {
		text-decoration: none;
	}

	#result {
		background-color: whitesmoke;
		font-size: 13px;
	}

	.btn:focus, .btn.focus {
		outline: 0;
		box-shadow: 0 0 0 0.1rem rgba(0, 123, 255, 0.25);
	}

	.btn-primary:focus, .btn-primary.focus {
		box-shadow: 0 0 0 0.1rem rgba(0, 123, 255, 0.5);
	}

	.btn-info:focus, .btn-info.focus {
		box-shadow: 0 0 0 0.1rem rgba(23, 162, 184, 0.5);
	}

	.btn-success:focus, .btn-success.focus {
		box-shadow: 0 0 0 0.1rem rgba(40, 167, 69, 0.5);
	}

	.btn-warning:focus, .btn-warning.focus {
		box-shadow: 0 0 0 0.1rem rgba(255, 193, 7, 0.5);
	}

	.btn-danger:focus, .btn-danger.focus {
		box-shadow: 0 0 0 0.1rem rgba(220, 53, 69, 0.5);
	}
</style>

<body>
	<div class="row">
		<h1><a href="https://plagiarismsearch.com" target="_blank" class="titulo">Plagiarism Search</a></h1>
	</div>
	<hr>
	<div class="row">
		<div class="col-3">
			<ol class="list-group">
				<li class="list-group-item">
					<button id="account" class="btn btn-sm btn-info">Detalles de cuenta</button>
				</li>

				<li class="list-group-item">
					<button id="list" class="btn btn-sm btn-primary">Ver todos mis reportes</button>
				</li>

				<li class="list-group-item">
					<h6 id="warning-create" style="display: none;"><span class="badge badge-secondary">Ponle titulo</span></h6>
					<h6 id="warning-create2" style="display: none;"><span class="badge badge-secondary">Llena uno de los 3 campos por lo menos</span></h6>
					<input type="text" id="title" class="form-group form-control form-control-sm" placeholder="Titulo">
					<textarea id="text" class="form-group form-control form-control-sm" placeholder="OBSERVACIONES/TEXTO ADJUNTO"></textarea>
					<div class="input-group">
						<label class="input-group-prepend">
							<span class="btn btn-sm btn-success">SUBIR ARCHIVO(S)<input type="file" id="file" style="display: none;"></span>
						</label>
						<input type="text" id="file-text" class="form-group form-control form-control-sm" value="Sin archivo adjunto..." readonly>
					</div>
					<input type="text" id="url" class="form-group form-control form-control-sm" placeholder="URL">
					<button id="create" class="btn btn-sm btn-outline-success">ENVIAR</button>
				</li>

				<li class="list-group-item">
					<h6 id="warning-view" style="display: none;"><span class="badge badge-secondary">Selecciona un reporte</span></h6>
					<select id="reportes" class="form-group form-control form-control-sm"></select>
					<button id="view" class="btn btn-sm btn-info">Ver reporte seleccionado</button>
				</li>

				<li class="list-group-item">
					<h6 id="warning-update"><span class="badge badge-secondary">Selecciona un reporte arriba</span></h6>
					<input type="text" id="title-update" class="form-group form-control form-control-sm" placeholder="Titulo" disabled>
					<textarea id="text-update" class="form-group form-control form-control-sm" placeholder="Contenido" disabled></textarea>
					<button id="update" class="btn btn-sm btn-warning" disabled>Actualizar reporte</button>
				</li>

				<li class="list-group-item">
					<h6 id="warning-delete"><span class="badge badge-secondary">Selecciona un reporte arriba</span></h6>
					<button id="delete" class="btn btn-sm btn-danger" disabled>Borrar reporte</button>
				</li>

				<li class="list-group-item">
					<h6 id="warning-status"><span class="badge badge-secondary">Selecciona un reporte arriba</span></h6>
					<button id="status" class="btn btn-sm btn-info" disabled>Estado de reporte</button>
				</li>
			</ol>
		</div>
		<div class="col-9">
			<div id="res_div" class="row" style="display: none;">
				<div class="col-auto">
					<h4>Palabras: <span id="num_words"></span></h4>
				</div>
				<div class="col-auto">
					<h4>Plagio: <span id="plagiat"></span>%</h4>
				</div>
				<div class="col-auto">
					<a id="btn-link" class="btn btn-sm btn-primary">Ver reporte</a>
					<button id="btn-link-null" class="btn btn-sm btn-primary" style="display: none;" disabled>Checando...</button>
				</div>
			</div>
			<pre id="result"></pre>
		</div>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
	<script type="text/javascript">
		$(function() {

			function getReportes(cmd) {
				$.ajax({
					url: 'actions/showAll.php',
					method: 'POST'
				}).done(function(data) {
					switch(cmd) {
						case 1:
							$('#reportes').prop('disabled', true).empty().append('<option value="" selected disabled>Seleccionar reporte</option>');
							$.each(data.data, function(i, reporte) {
								let list = '';
								list += `<option value="${reporte.id}">`;
								list += reporte.title;
								list += '</option>';
								$('#reportes').append($(list));
							});
							$('#reportes').prop('disabled', false);
							break;
						case 2:
							$('#result').text('').text(JSON.stringify(data, null, '\t'));
							reset();
							break;
					}
				}).fail(function(jqXHR) {
					console.log(jqXHR);
				});
			}

			function reset() {
				$('#warning-update, #warning-delete, #warning-status').show();
				$('#title-update, #text-update').val('').prop('disabled', true);
				$('#update, #delete, #status').data('id', null).prop('disabled', true);
				$('#plagiat').text('');
				$('#btn-link').attr('href', '#');
				$('#res_div').hide();
				getReportes(1);
				$('#reportes').val(null);
			}

			getReportes(1);
			$('input').attr('autocomplete', 'off');

			$('#account').on('click', function() {
				$.ajax({
					url: 'actions/account.php',
					method: 'POST',
				}).done(function(data) {
					$('#result').text('').text(JSON.stringify(data, null, '\t'));
					reset();
				}).fail(function(jqXHR) {
					console.log(jqXHR);
				});
			});

			$('#list').on('click', function() {
				getReportes(2);
			});

			$('#create').on('click', function() {

				let $title = $('#title');
				let $text = $('#text');
				let $file = $('#file');
				let $url = $('#url');

				if($title.val() == '') {
					$('#warning-create').show().delay(4000).fadeOut();
					return null;
				}
				if(!$text.val() && !$file.val() && !$url.val()) {
					$('#warning-create2').show().delay(4000).fadeOut();
					return null;
				}

				let data = new FormData();

				data.append('title', $title.val());
				if($text.val()) data.append('text', $text.val());
				if($file.val()) {
					$.each($file[0].files, function(i, file) {
						data.append('file-' + i, file);
					});
				}
				if($url.val()) data.append('url', $url.val());

				let object = {};
				data.forEach(function(value, i) {
					object[i] = value;
				});
				console.log(object);

				$.ajax({
					url: 'actions/create.php',
					method: 'POST',
					data: data,
					cache: false,
					contentType: false,
					processData: false
				}).done(function(data) {
					$('#result').text('').text(JSON.stringify(data, null, '\t'));
					$title.val('');
					$text.val('');
					$file.val('');
					$('#file-text').val('Sin archivo adjunto...');
					$url.val('');
					getReportes(1);
				}).fail(function(jqXHR) {
					console.log(jqXHR);
				});
			});

			$(':file').on('change', function() {
				let $input = $(this);
				let numFiles = $input.get(0).files ? $input.get(0).files.length : 1;
				let label = $input.val().replace(/\\/g, '/').replace(/.*\//, '');
				$input.trigger('fileselect', [numFiles, label]);
			}).on('fileselect', function(event, numFiles, label) {
				let $text = $(this).parents('.input-group').find(':text');
				let log = numFiles > 1 ? numFiles + ' files selected' : label;
				if($text.length) {
					$text.val(log);
				} else {
					if(log) alert(log);
				}
			});

			$('#view').on('click', function() {
				if($('#reportes').val() == null || $('#reportes').val() == '') {
					$('#warning-view').show().delay(4000).fadeOut();
					return null;
				}
				$.ajax({
					url: 'actions/show.php',
					method: 'POST',
					data: {
						id: parseInt($('#reportes').val())
					}
				}).done(function(data) {
					$('#result').text('').text(JSON.stringify(data, null, '\t'));

					$('#num_words').text('').text(data.data.length);
					$('#plagiat').text('').text(data.data.plagiat);

					if(data.data.file != null) {
						let link = (data.data.file) ? data.data.file : '#';
						link = link.replace('/download/', '/pdf/');
						$('#btn-link-null').hide();
						$('#btn-link').attr('href', link).attr('target', '_blank');
					} else {
						$('#btn-link').hide();
						$('#btn-link-null').show()
					}
					$('#res_div').show();

					$('#warning-update, #warning-delete, #warning-status').hide();

					$('#title-update').val(data.data.title);
					$('#text-update').val(data.data.text);
					$('#title-update, #text-update').prop('disabled', false);

					$('#update, #delete, #status').data('id', data.data.id).prop('disabled', false);

					$('#reportes').val(null);
				}).fail(function(jqXHR) {
					console.log(jqXHR);
				});
			});

			$('#update').on('click', function() {
				let id = parseInt($(this).data('id'));

				$.ajax({
					url: 'actions/update.php',
					method: 'POST',
					data: {
						id: id,
						title: $('#title-update').val(),
						text: $('#text-update').val()
					}
				}).done(function(data) {
					$('#result').text('').text(JSON.stringify(data, null, '\t'));

					reset();

				}).fail(function(jqXHR) {
					console.log(jqXHR);
				});
			});

			$('#delete').on('click', function() {
				let id = parseInt($(this).data('id'));

				let seguro = confirm('Seguro que quieres borrar este reporte?');
				if(seguro == true) {
					$.ajax({
						url: 'actions/delete.php',
						method: 'POST',
						data: {
							id: id
						}
					}).done(function(data) {
						$('#result').text('').text(JSON.stringify(data, null, '\t'));

						reset();

					}).fail(function(jqXHR) {
						console.log(jqXHR);
					});
				}
			});

			$('#status').on('click', function() {
				let id = parseInt($(this).data('id'));

				$.ajax({
					url: 'actions/status.php',
					method: 'POST',
					data: {
						id: id
					}
				}).done(function(data) {
					$('#result').text('').text(JSON.stringify(data, null, '\t'));

					reset();

				}).fail(function(jqXHR) {
					console.log(jqXHR);
				});
			});
		});
	</script>
</body>

</html>